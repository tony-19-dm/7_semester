#include <unistd.h>
#include "plates.h"

// Функция для управления движением управляемого снаряда (RCM - Remote Controlled Missile)
// rcmNum - номер снаряда
// dx, dy - направление движения по осям X и Y (-1, 0, 1)
// steps - количество шагов движения
void moveRCM(int rcmNum, int dx, int dy, int steps) {
    for (int i = 0; i < steps; i++) {
        // Объединение для формирования команды управления снарядом
        // Команда передается как 4-байтовое значение через регистр
        union { 
            signed char c[4];  // Массив из 4х знаковых байт
            int i;             // Целое число для отправки в регистр
        };
        
        // Заполнение байтов команды:
        c[0] = dx;  // Направление по оси X: -1 (влево), 0 (стоп), 1 (вправо)
        c[1] = dy;  // Направление по оси Y: -1 (вверх), 0 (стоп), 1 (вниз)
        c[2] = 0;   // Резервный байт (не используется)
        c[3] = 1;   // Флаг выполнения команды (1 - выполнить)
        
        // Выбор управляемого снаряда по номеру
        putreg(RG_RCMN, rcmNum);
        
        // Отправка команды движения снаряду
        putreg(RG_RCMC, i);
        
        // Задержка для контроля скорости движения снаряда
        // RCMDelay - константа, определяющая задержку между шагами (в микросекундах)
        delay(RCMDelay / 1000000);
    }
}

int main() {
    // Инициализация игры с уровнем 0 (без тарелок, только движение снаряда)
    StartGame(0);

    int rcmNum = 0;  // Используем снаряд номер 0
    
    // Выбор снаряда для управления
    putreg(RG_RCMN, rcmNum);
    
    // Команда запуска снаряда
    putreg(RG_RCMC, RCMC_START);
    
    // === ДВИЖЕНИЕ ПО КВАДРАТУ 200x200 ===
    
    // Движение вверх на 200 шагов (dx=0, dy=-1)
    moveRCM(rcmNum, 0, -1, 200);
    
    // Движение вправо на 200 шагов (dx=1, dy=0)  
    moveRCM(rcmNum, 1, 0, 200);
    
    // Движение вниз на 200 шагов (dx=0, dy=1)
    moveRCM(rcmNum, 0, 1, 200);
    
    // Движение влево на 200 шагов (dx=-1, dy=0)
    moveRCM(rcmNum, -1, 0, 200);
    
    // === ДВИЖЕНИЕ ПО ПРЯМОУГОЛЬНИКУ 500x200 ===
    
    // Движение влево на 250 шагов (dx=-1, dy=0)
    moveRCM(rcmNum, -1, 0, 250);
    
    // Движение вверх на 200 шагов (dx=0, dy=-1)
    moveRCM(rcmNum, 0, -1, 200);
    
    // Движение вправо на 500 шагов (dx=1, dy=0) - длинная сторона прямоугольника
    moveRCM(rcmNum, 1, 0, 500);
    
    // Движение вниз на 200 шагов (dx=0, dy=1)
    moveRCM(rcmNum, 0, 1, 200);
    
    // Движение влево на 250 шагов (dx=-1, dy=0) - возврат в начальную точку
    moveRCM(rcmNum, -1, 0, 250);
    
    // Завершение игры
    EndGame();
    
    return 0;
}